<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Linka 2 - TEST</title>
</head>
<body style="background: #121212; color: white; font-family: sans-serif; padding: 20px;">
    <h1>Stav Linky 2 (DPO)</h1>
    <p id="info">Zjišťuji data přes záložní kanál...</p>
    <div id="vysledek"></div>

    <script>
        async function testData() {
            const res = document.getElementById('vysledek');
            // Zkusíme AllOrigins v "raw" režimu, který je nejagresivnější v získávání dat
            const url = "https://api.allorigins.win/raw?url=" + encodeURIComponent("https://mapa.kodis.cz/api/vehicles");

            try {
                const response = await fetch(url);
                const data = await response.json();
                
                // Vyfiltrujeme linku 2
                const linka2 = data.vehicles.filter(v => v.route_short_name === "2");
                
                if (linka2.length > 0) {
                    let text = "<ul>";
                    linka2.forEach(v => {
                        text += `<li><b>Vůz ${v.vehicle_id}</b> - Zpoždění: ${Math.round(v.delay/60)} min.</li>`;
                    });
                    res.innerHTML = text + "</ul>";
                    document.getElementById('info').innerText = "Data načtena v " + new Date().toLocaleTimeString();
                } else {
                    res.innerHTML = "Na lince 2 aktuálně nic nejede nebo jsou data nedostupná.";
                }
            } catch (e) {
                res.innerHTML = "Chyba: Servery jsou momentálně přetížené. Zkus to prosím až po 19:00, až skončí špička.";
            }
        }
        testData();
    </script>
</body>
</html>
